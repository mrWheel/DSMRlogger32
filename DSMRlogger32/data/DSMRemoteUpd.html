<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="DSMRindex.css">
    <title>DSMR-logger32  (Remote Update)</title>
    <script>
        async function fetchVersions() 
        {
            try 
            {
                const response = await fetch('/RFUlistFirmware');
                if (!response.ok) 
                {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const filenames = await response.json();

                const select = document.getElementById('versionSelect');
                select.innerHTML = '<option value="">Select version</option>';
                filenames.forEach(file => {
                    const option = document.createElement('option');
                    option.value = file;
                    option.textContent = file;
                    select.appendChild(option);
                });
            } 
            catch (error) 
            {
                console.error('Error fetching versions:', error);
                document.getElementById('versionSelect').innerHTML = `<option value="">Error fetching versions: ${error.message}</option>`;
            }
        }

        function submitForm(action) 
        {
            const form = document.getElementById('updateForm');
            const select = form.elements['newVersionNr'];
            if (action === 'Update' && (select.value === '' || select.value === 'none')) 
            {
                alert('Please select a valid version');
                return;
            }
            const actionInput = document.createElement('input');
            actionInput.type = 'hidden';
            actionInput.name = 'action';
            actionInput.value = action;
            form.appendChild(actionInput);
            form.submit();
        }
    </script>
</head>
<body onload="fetchVersions()">
    <h1>DSMR-logger32  (Remote Update)</h1>
    <form id="updateForm" method="POST">
        Select Version: <select id="versionSelect" name="newVersionNr"></select><br><br>
        <button type="button" onclick="submitForm('Update')">Update</button>
        <button type="button" onclick="submitForm('Return')">Return</button>
    </form>
</body>
</html>